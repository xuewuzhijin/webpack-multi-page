# ä½¿ç”¨ TypeScript è‡ªå®šä¹‰ Webpack å¤šé¡µåº”ç”¨

## æ›´æ–°æ—¥å¿—

ä»¥å‰æ²¡æƒ³åˆ°è¿™é—®é¢˜ï¼Œç›´åˆ°æƒ³èµ·äº†å¦‚æœç”¨æˆ·ä½¿ç”¨è¯¥åº“å¯¼è‡´åé¢ä¸çŸ¥å¦‚ä½•å‡çº§ï¼Œæ‰€ä»¥åŠ å…¥æ›´æ–°æ—¥å¿—ï¼Œåªæ˜¯å‰æœŸçš„é…ç½®æ²¡åŠæ³•äº†ï¼Œç‰ˆæœ¬ä» `1.1.0` å¼€å§‹ã€‚

<details>

### 1.2.0

* â• æ·»åŠ  `ejs-loader`, é¡µé¢æ–‡ä»¶å…è®¸ä½¿ç”¨ `.ejs` åç¼€äº†
* â• å¯ä»¥é…ç½®å…¬å…± `CDN` äº† *å‰å¾€ `depoly -> config.js.cdn` è¿›è¡Œé…ç½®*
* â• å¯ä»¥é…ç½®å…¬å…±æ¨¡æ¿æ–‡ä»¶äº†ï¼Œå¦‚å…¬å…±å¤´éƒ¨ã€åº•éƒ¨ã€ä¾§æ ã€ç»„ä»¶...*å‰å¾€ `public -> template` è¿›è¡Œé…ç½®*
* ğŸ“˜ è§£å†³ä¸€äº›è¯­æ³•é—®é¢˜

### 1.1.1

* ğŸ è§£å†³ä¸€ä¸ªå°BUGå¯¼è‡´import ts æ–‡ä»¶ç±»å‹ç¼–è¯‘å¤±è´¥é—®é¢˜
* â• æ›´æ–°ç±»å‹æ£€æŸ¥ç”Ÿæˆç›®å½•åœ°å€ï¼Œå’Œæ·»åŠ å®šä¹‰å…¬å…±ç±»å‹ã€å…¬å…±é…ç½®ç›®å½•åœ°å€ï¼ˆ public/configã€public/types ï¼‰
* ğŸ“˜ è§£å†³è¯­æ³•å†—é•¿å’Œæ·»åŠ æ³¨é‡Šä¿¡æ¯

### 1.1.0

* å¢åŠ ç¼–è¾‘å™¨å¯¹æ¨¡å—åçš„æ”¯æŒ @ -> Project root path
* react ç¼–è¯‘æ’ä»¶é…ç½®è½¬ç§»åˆ° babel
* ç§»é™¤é‡å¤é…ç½®


</details>

## é¡¹ç›®ç›®å½•ç»“æ„

<details>
<summary>åŒ…å«è¾“å‡ºç›®å½•</summary>

```Js
./
â”œâ”€â”€ deploy
â”‚Â Â  â”œâ”€â”€ _util
â”‚Â Â  â””â”€â”€ config.ts
â”œâ”€â”€ dist
â”‚Â Â  â”œâ”€â”€ assets
â”‚Â Â  â”‚Â Â  â””â”€â”€ images
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 5a25b6fd30231.jpg
â”‚Â Â  â”‚Â Â      â””â”€â”€ 5a25b6fd30231.jpg.gz
â”‚Â Â  â”œâ”€â”€ css
â”‚Â Â  â”‚Â Â  â””â”€â”€ 3.css
â”‚Â Â  â”œâ”€â”€ js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 0.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 1.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 2.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 3.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 4.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ 5.js
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ about
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ contact
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.html
â”‚Â Â  â””â”€â”€ news
â”‚Â Â      â”œâ”€â”€ index.html
â”‚Â Â      â””â”€â”€ list
â”‚Â Â          â”œâ”€â”€ detail
â”‚Â Â          â”‚Â Â  â””â”€â”€ index.html
â”‚Â Â          â””â”€â”€ index.html
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ assets
â”‚Â Â  â”‚Â Â  â””â”€â”€ images
â”‚Â Â  â”‚Â Â      â””â”€â”€ img.jpg
â”‚Â Â  â”œâ”€â”€ config
â”‚Â Â  â”œâ”€â”€ styles
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ common.styl
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ env.styl
â”‚Â Â  â”‚Â Â  â””â”€â”€ style.css
â”‚Â Â  â”œâ”€â”€ template
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ head.ejs
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ header.html
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ default.html
â”‚Â Â  â”‚Â Â  â””â”€â”€ footer.css
â”‚Â Â  â”œâ”€â”€ types
â”‚Â Â  â””â”€â”€ utils
â”‚Â Â      â””â”€â”€ test.ts
â”œâ”€â”€ views
â”‚Â Â  â”œâ”€â”€ -a
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ _a
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.js
â”‚Â Â  â”œâ”€â”€ about
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.ejs
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ contact
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ news
â”‚Â Â  â”‚   â”œâ”€â”€ index.html
â”‚Â Â  â”‚   â”œâ”€â”€ index.js
â”‚Â Â  â”‚   â””â”€â”€ list
â”‚Â Â  â”‚       â”œâ”€â”€ detail
â”‚Â Â  â”‚       â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”‚       â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â”‚       â”œâ”€â”€ index.html
â”‚Â Â  â”‚       â””â”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ index.ejs
â”‚Â Â  â””â”€â”€ index.ts
â”œâ”€â”€ README.md
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ webpack.config.ts
â”œâ”€â”€ webpack.config.dev.ts
â””â”€â”€ webpack.config.prod.ts
```

</details>

## æ¨¡å—åˆ«å

---

è·¯å¾„ | åˆ«å | è¯´æ˜
-|-|-
/  |  @  |  é¡¹ç›®æ ¹ç›®å½•
public/assets  |  @assets  |  é™æ€èµ„æº
public/config  |  @config  |  é¡¹ç›®é…ç½®æ–‡ä»¶å­˜æ”¾å¤„
public/styles  |  @styles  |  å…¨å±€æ ·å¼/å˜é‡
public/types   |  @types  |  é¡¹ç›®ç±»å‹å®šä¹‰
public/utils   |  @utils  |  é¡¹ç›®å·¥å…·åŒ…ä¾èµ–
public/template   |  @template  |  æ¨¡æ¿æ–‡ä»¶å¤¹
views/*   |  @views  |  è¯¥ç›®å½•ä¸‹ï¼Œåªè¦æœ‰åŒ…å«å®šä¹‰è¿‡çš„`[customeName].[jt]s` æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åç›¸å¯¹åº”çš„æœ‰ä¸€ä¸ªåŒåçš„ `html` æ–‡ä»¶ï¼Œå¦‚æœè¯¥ `html` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶ï¼Œ[é…ç½®æ–‡ä»¶](#å¼€ç®±å³ç”¨)

ä¾‹å¦‚ï¼š

```Js

import XXX from "@assets/xxx...";

```

* `deploy`  é¡¹ç›®éƒ¨ç½²ç›®å½•
  * `_util`     è¯¥é¡¹ç›®çš„å·¥å…·åº“ï¼Œé€‚åˆé«˜çº§ç©å®¶é…ç½®
  * `config.ts` ç”¨æˆ·é…ç½®æ–‡ä»¶
* `dist`  æ‰“åŒ…è¾“å‡ºè·¯å¾„
* `public` å…¬å…±è·¯å¾„
  * `assets` é™æ€èµ„æº
    * `images`
    * `fonts`
  * `config`  é¡¹ç›®é…ç½®æ–‡ä»¶
  * `styles`  å…¨å±€æ ·å¼/å˜é‡
  * `types` ç±»å‹å®šä¹‰
  * `utils` é¡¹ç›®å·¥å…·åº“
* `views` è§†å›¾å±‚

---

## å·²é…ç½®é¡¹

* stylus

é¡¹ç›®åˆå§‹åŒ–ä½¿ç”¨ `stylus` ä½œä¸ºæ ·å¼å·¥å…·ï¼Œæ— è®ºåœ¨å“ªé‡Œåˆ›å»ºäº† stylus æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ public > styles > env.styl æ–‡ä»¶å†…çš„å˜é‡ï¼Œæ— éœ€åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­å¼•å…¥

* cssæ ·å¼å…¼å®¹

åŠ å…¥äº† css çš„æ ·å¼å…¼å®¹ï¼Œå¼€å¯ grid å¸ƒå±€å…¼å®¹

* vue/react/i18n...

é¡¹ç›®åŠ å…¥äº† `vue` æ–‡ä»¶å¤„ç†ï¼Œä½†ä¸å‚ä¸æ‰“åŒ…ï¼Œä¹Ÿå°±æ˜¯ï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ vue è¿™ä¸ªæ’ä»¶ï¼Œä½†åœ¨æ‰“åŒ…æ—¶ï¼Œvue å°†ä¸ä¼šå‡ºç°åœ¨æ‰“åŒ…æ–‡ä»¶ä¸­ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¯·æ ¹æ®æƒ…å†µåœ¨æ¯ä¸ª views ä¸‹çš„ .html æ–‡ä»¶ä¸­åŠ å…¥ vue çš„ cdn

* gzip

é¡¹ç›®æ‰“åŒ…ä¹‹åä¼šè‡ªåŠ¨ç”Ÿæˆ x.js.gz æ–‡ä»¶ï¼Œå¦‚æœæœåŠ¡å™¨å…è®¸çš„è¯

* split chunks

é¡¹ç›®ä¸­å¦‚æœæœ‰å¼•ç”¨å…¬å…±çš„ `.js/.ts/.css` æ–‡ä»¶ï¼Œæ‰“åŒ…åï¼Œåªè¦è¯¥æ–‡ä»¶è¶…è¿‡ 10Kï¼Œå°†è‡ªåŠ¨åˆ‡å‰²æˆå…¬å…±å—ï¼Œä¹Ÿå°±æ˜¯å¤šé¡µé¢ï¼ˆ.htmlï¼‰ä¼šè‡ªåŠ¨å¼•ç”¨è¿™ä¸ªå…¬å…±å—ï¼Œå¦‚æœæ²¡æœ‰ä¾èµ–è¯¥å…¬å…±å—ä¹Ÿå°±ä¸ä¼šå¼•ç”¨

* å¤šçº¿ç¨‹æ‰“åŒ…

è¯¥é¡¹ç›®é’ˆå¯¹é¡¹ç›®ä¸­çš„ `js`ã€ `ts` å¼€å¯å¤šçº¿ç¨‹æ‰“åŒ…ï¼Œæé«˜æ‰“åŒ…ç­‰å¾…æ—¶é—´è¿‡é•¿å¼Šç«¯å¹¶å¼€å¯ç¼“å­˜ï¼Œé’ˆå¯¹å¤§å‹é¡¹ç›®æ•ˆæœéå¸¸æ˜æ˜¾

* ä½¿ç”¨ `babel` ç¼–è¯‘ typescript

ç”±äºä½¿ç”¨ ts-loader ä»¥åŠ awesome-typescript-loader åœ¨å¼€å‘ç¼–è¯‘ä¸­ï¼ˆå°¤å…¶æ˜¯çƒ­æ›´æ–°ï¼‰ç¼–è¯‘é€Ÿåº¦è¿‡æ…¢ï¼Œæ‰€ä»¥è¯¥é¡¹ç›®ç§»å»è¯¥ loader å¹¶é‡‡ç”¨ babel æ¥ç¼–è¯‘ï¼Œæé«˜å¼€å‘ä½“éªŒ

* polyfill

é¡¹ç›®é‡‡ç”¨ babel é«˜åº¦å®šåˆ¶ï¼Œå¹¶æŒ‰éœ€å¡«å……æœ€æ–°è¯­æ³•ï¼Œå¦‚ Promiseã€Generatorã€Flatâ€¦â€¦ï¼Œæ›´å¤šæ–°åŠŸèƒ½ç­‰å¾…æ‚¨çš„å‘ç°

* æ”¯æŒå¯é€‰é“¾å¼è°ƒç”¨

å½“ä½ ä¸ç¡®å®šè¯¥ `Object` / `Function`...ä¸‹é¢æ˜¯å¦æœ‰æŸå±æ€§æ—¶ï¼Œæ­¤æ—¶ä½ çš„å†™æ³•çœ‹èµ·æ¥åƒè¿™æ ·

```JavaScript
const obj = { a: {} }
if( obj.a && obj.a.b && obj.a.b.c ) {
  // do something
}

// é‚£ä¹ˆæ­¤æ—¶ä½ å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•
if( obj.a?.b?.c ) {
  // do something
}

// è¯¥è¯­æ³•ä¼šè½¬æ¢ä½ çš„è¡¨è¾¾å¼ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·
// null==obj.a?void 0:null===(r=obj.a.b)||void 0===obj.a?void 0:null===(o=obj.a.b)...

// åœ¨ JS ä¸­ï¼Œ null == undefined (true)ï¼Œ ä½† null === undefined (false) æ˜¯é”™çš„

// æ€»ç»“æ¥è¯´ï¼Œè¯¥è¡¨è¾¾å¼åªè¦åœ¨æŸä¸€æ­¥å‡ºç°äº† null æˆ– undefined éƒ½ä¼šè¿”å› undefinedï¼ŒJs ä¸­è‡ªåŠ¨ç±»å‹è½¬æ¢ä¸ºå°±æ˜¯ false äº†ï¼Œå‡è‹¥ä¸ºçœŸï¼Œé‚£ä¹ˆè¿”å›å¯¹åº”çš„å€¼

```

* ES6/7æ”¯æŒ

é™¤äº†ä¸Šé¢æ‰€å†™çš„ polyfill å¤–ï¼Œè¿˜æ”¯æŒäº†å¯¹ JavaScript çš„ `class`ï¼Œä»¥åŠå®ƒçš„è£…é¥°å™¨(Decorator)è¯­æ³•ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·

```Js
class Fly {
  @When(/* some code... */)
}

function When( value ) {
  // do someting
}
```

* å…¬å…±æ¨¡æ¿æ–‡ä»¶ï¼ˆå¤´éƒ¨ã€åº•éƒ¨ã€ä¾§æ ...ï¼‰

è‡ªå®šä¹‰å…¬å…±çš„æ¨¡æ¿æ–‡ä»¶åœ¨å…¶å®ƒé¡µé¢å®ç°å…¬ç”¨ï¼Œå¯ä»¥ç†è§£ä¸ºç»„ä»¶å¤ç”¨

é™¤äº†ä»¥ä¸Šå‡ ä¹æ¶µç›–äº†æ—¥å¸¸ä½ æ‰€éœ€çš„ ES6 è¯­æ³• + ES7 å’Œéƒ¨åˆ† ES8è¯­æ³•ç­‰

* å¾…æŒç»­ä¼˜åŒ–...

å¦‚æœä½ æœ‰å¥½çš„æ’ä»¶ä»‹ç»ã€æˆ–è€…å¯¹è¯¥é¡¹ç›®æœ‰å»ºè®®ã€æˆ–æƒ³å‚ä¸åˆ°å¼€å‘ä¸­ï¼Œæ¬¢è¿åˆ° `issue` ä¸­æå‡ºã€‚å¦‚æœå¯¹è¯¥é¡¹ç›®æ„Ÿå…´è¶£é¼“åŠ± `watch` æ¬¢è¿ `star`

## å¼€ç®±å³ç”¨

æ‰“å¼€éƒ¨ç½²ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®è‡ªèº«éœ€æ±‚å¼€å¯æ’ä»¶ï¼Œæ— éœ€å»é…ç½®é¢å¤–çš„æ’ä»¶åŠå±æ€§ï¼Œä¹Ÿä¸éœ€è¦åœ¨é¡¹ç›®ä¸­åˆ åˆ æ”¹æ”¹ï¼Œ`true` ä¸ `false` è®©ä½ è½»æ¾æå®š[å‰å¾€æ–‡ä»¶](./deploy/config.ts)

```Js
export default {
  /** å…¥å£é…ç½®æ–‡ä»¶ */
  entry: {
    /** å¿½ç•¥å‰ç¼€æ–‡ä»¶å¤¹ä¸ä½œä¸ºå…¥å£æ–‡ä»¶ */
    ignorePrefix: [ "~", "-", "_" ],
    /** å“ªäº›æ–‡ä»¶åç§°ä½œä¸ºå…¥å£ */
    name: [ "index", "entry" ]
  },

  templatePath: "./deploy/template/index.html",

  /** æ˜¯å¦å¼€å¯è¯¥æ’ä»¶ */
  plugin: {
    vue: true,

    vueI18n: false,

    vuePug: false,

    eslint: false,

    react: false,
  }
  // ...
}
```

## ä½¿ç”¨æ­¥éª¤

```Bash
# å…‹éš†
git clone https://github.com/xuewuzhijin/webpack-multiple-pages.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd webpack-multiple-pages

# å®‰è£…ä¾èµ–
npm i

# å¼€å‘
npm run serve

# or ç”Ÿäº§
npm run build


## å¦‚æœç¼–è¯‘å‡ºç°æŠ¥é”™ï¼Œæ¯”å¦‚çœ‹èµ·æ¥åƒè¿™æ ·

#
# Fatal error in , line 0
# Check failed: U_SUCCESS(status).
#
#
#
#FailureMessage Object: 00000045E791C0E0â€‰ERRORâ€‰ Command failed with exit code 3221225477.

## è¯·å‡çº§ä½ çš„ NodeJs
```
